# MRT: comlinkjs & worker-loader issue in Vue

Minimum Reproducible Test Repo

## Objective

To use `worker-loader` with `webpack` to load background workers that can be instantiated with `comlinkjs`.

## Steps to reproduce

**Step 1:** Close the repo 

The repo was generated using Vue Cli with the following dependencies: 

_vue-router, vuex, sass, babel, pwa, eslint, unit-jest, e2e-cypress_

**Step 2:** Install the dependencies

```bash
npm install
```

There are two dependencies (other than the ones generated by Vue Cli: ) - [comlinkjs](https://github.com/GoogleChromeLabs/comlink) and [worker-loader](https://github.com/webpack-contrib/worker-loader)

**Step 3:** Build the project

```bash
npm run build
``` 

Ideally this should succeed and should generate a _dist/_ directory with the built resources. However, this fails with the following error: 

```bash
npm run build                                                                                                                                                1 ↵

> worker-loader-issue@0.1.0 build /mnt/d/workspace/others/worker-loader-issue
> vue-cli-service build --modern


⠙  Building legacy bundle for production...

 ERROR  Failed to compile with 1 errors                                                                                                                      19:21:20
 error  in ./src/workers/sample.worker.js

Module build failed (from ./node_modules/thread-loader/dist/cjs.js):
Thread Loader (Worker 1)
Cannot read property 'createChildCompiler' of undefined

    at Object.pitch (/mnt/d/workspace/others/worker-loader-issue/node_modules/worker-loader/dist/index.js:83:39)

 @ ./node_modules/cache-loader/dist/cjs.js??ref--12-0!./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/vue-loader/lib??vue-loader-options!./src/components/HelloWorld.vue?vue&type=script&lang=js& 48:0-51 74:33-45
 @ ./src/components/HelloWorld.vue?vue&type=script&lang=js&
 @ ./src/components/HelloWorld.vue
 @ ./node_modules/cache-loader/dist/cjs.js??ref--12-0!./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/vue-loader/lib??vue-loader-options!./src/views/Home.vue?vue&type=script&lang=js&
 @ ./src/views/Home.vue?vue&type=script&lang=js&
 @ ./src/views/Home.vue
 @ ./src/router.js
 @ ./src/main.js
 @ multi ./src/main.js

 ERROR  Build failed with errors.
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! worker-loader-issue@0.1.0 build: `vue-cli-service build --modern`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the worker-loader-issue@0.1.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
```

#### Vue Info

```bash
vue info

Environment Info:


  System:
    OS: Linux 4.4 Ubuntu 16.04.4 LTS (Xenial Xerus)
    CPU: (8) x64 Intel(R) Core(TM) i7-8650U CPU @ 1.90GHz
  Binaries:
    Node: 9.11.1 - /usr/bin/node
    Yarn: Not Found
    npm: 6.5.0 - /usr/bin/npm
  Browsers:
    Chrome: Not Found
    Firefox: Not Found
  npmPackages:
    @vue/babel-preset-app:  3.2.0
    @vue/cli-overlay:  3.2.0
    @vue/cli-plugin-babel: ^3.2.0 => 3.2.0
    @vue/cli-plugin-e2e-cypress: ^3.2.0 => 3.2.0
    @vue/cli-plugin-eslint: ^3.2.0 => 3.2.1
    @vue/cli-plugin-pwa: ^3.2.0 => 3.2.0
    @vue/cli-plugin-unit-jest: ^3.2.0 => 3.2.0
    @vue/cli-service: ^3.2.0 => 3.2.0
    @vue/cli-shared-utils:  3.2.0
    @vue/component-compiler-utils:  2.3.1
    @vue/eslint-config-airbnb: ^4.0.0 => 4.0.0
    @vue/preload-webpack-plugin:  1.1.0
    @vue/test-utils: ^1.0.0-beta.20 => 1.0.0-beta.27
    @vue/web-component-wrapper:  1.2.0
    babel-helper-vue-jsx-merge-props:  2.0.3
    babel-plugin-transform-vue-jsx:  4.0.1
    eslint-plugin-vue: ^5.0.0-0 => 5.0.0
    jest-serializer-vue:  2.0.2
    vue: ^2.5.17 => 2.5.21
    vue-eslint-parser:  2.0.3
    vue-hot-reload-api:  2.3.1
    vue-jest:  3.0.2
    vue-loader:  15.4.2
    vue-router: ^3.0.1 => 3.0.2
    vue-style-loader:  4.1.2
    vue-template-compiler: ^2.5.17 => 2.5.21
    vue-template-es2015-compiler:  1.6.0
    vuex: ^3.0.1 => 3.0.1
  npmGlobalPackages:
    @vue/cli: 3.2.1
```
